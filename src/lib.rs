//! Main implementation of the simulation